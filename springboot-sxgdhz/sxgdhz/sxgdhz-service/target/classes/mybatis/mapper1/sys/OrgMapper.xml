<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pers.zb.center.service.user.oracleDao.IOrgDao" >

	<sql id="Base_Column_List" >
	    keyId, orgName, areaId, sortNo, industryId,versionName, createTime
	 </sql>
	<!-- 查询机构信息 -->
	<select id="findAllOrg" resultType="pers.zb.center.service.user.entity.sys.Orglist" parameterType="java.util.Map">
	   select
	   keyId, orgName, areaId, sortNo,industryId,versionName,display, createTime,SSD_EMS_SYS_IDTONAMES('SSD_EMS_SYS_AREA','keyId','areaName',areaId) as areaName
	   from SSD_EMS_HR_ORGLIST
	   where display=1
	   <if test="orgName != null" > 
       and ORGNAME like '%${orgName}%'
      </if>
      <if test="areaId != null and areaId !=''" >
       and areaId =#{areaId}
      </if>
      <if test="orgId != null and orgId !=''" >
       and keyId =#{orgId}
      </if>
      order by sortNo
	</select>
	<select id="findAllOrgByBind" resultType="pers.zb.center.service.user.entity.sys.OrgBindMsgType" parameterType="java.util.Map">
	   select st.keyid,st.typename from SSD_EMS_HR_ORGLIST og right join Ssd_Ems_Alm_Orgmsgbind os on og.keyid=os.orgid join ssd_ems_sys_sendmessagetype st on
  		os.sendmessagetypeid=st.keyid and og.keyid=#{orgId}
	</select>
	<!-- 查询机构信息 -->
	<select id="findTotalRecords" resultType="java.lang.Integer" >
	   select  count(*)
	   from SSD_EMS_HR_ORGLIST
	   where display=1
	   <if test="orgName != null" >
       and ORGNAME like '%${orgName}%'
      </if>
      <if test="orgId !=null and orgId !=''">
       and keyId=#{orgId}
      </if>
      <if test="areaId != null" >
       and areaId =#{areaId}
      </if>
	</select>

	<!-- 分页查询机构信息 -->
	<select id="findAllOrgPage" resultType="pers.zb.center.service.user.entity.sys.Orglist">
	  select t3.* from
	  (select t2.*,ROWNUM as rowNumber
  		from (select keyId, orgName, areaId,industryId, sortNo,display, createTime,versionName,
  			SSD_EMS_SYS_IDTONAMES('SSD_EMS_SYS_AREA','keyId','areaName',areaId) as areaName,
  			SSD_EMS_SYS_IDTONAMES('SSD_EMS_SYS_INDUSTRY','keyId','industryName',industryId) as industryName
          from ssd_ems_hr_orglist t1 where display=1
     <if test="orgName != null and orgName !=''" >
       and t1.ORGNAME like '%${orgName}%'
      </if>
      <if test="orgId !=null and orgId !=''">
      	and t1.keyId=#{orgId}
      </if>
      <if test="areaId != null and areaId != ''"  >
       and t1.AREAID =#{areaId}
      </if>
      <if test="sortName != null and sortName != ''" >
       order by ${sortName} ${sortOrder}
      </if>
         ) t2) t3
	  <![CDATA[
		where t3.rownumber > #{offset}
  		 	and t3.rownumber <= #{limit} + #{offset}
	  ]]>

	</select>
	<!-- 分页查询机构信息 -->
	<select id="findDetailByid" resultType="pers.zb.center.service.user.entity.sys.Orglist" >
	 select t.*,SSD_EMS_SYS_IDTONAMES('SSD_EMS_SYS_AREA','keyId','areaName',areaId) as areaName
	   from SSD_EMS_HR_ORGLIST t
	  where t.keyid=#{keyId}
	</select>

	<!-- 根据机构名称查询机构信息 -->
	<select id="findDetailByName" resultType="pers.zb.center.service.user.entity.sys.Orglist" parameterType="java.lang.String">
	  select
	  <include refid="Base_Column_List" />
	  from SSD_EMS_HR_ORGLIST
	  where ORGNAME=#{orgName}
	</select>

	<select id="orgNameUniCheck" resultType="pers.zb.center.service.user.entity.sys.Orglist">
		select * from SSD_EMS_HR_ORGLIST
		where orgName = #{orgName}
		<if test="keyId != null and keyId != ''">
			and keyId !=#{keyId}
		</if>
	</select>
	<!-- 添加机构信息 -->
	<insert id="addOrg" >
		<selectKey resultType="java.lang.Integer" order="BEFORE" keyProperty="keyId">
		   SELECT SEQ_SSD_EMS_HR_ORGLIST.NEXTVAL as keyId FROM DUAL
		</selectKey>
		insert into ssd_ems_hr_orglist (
		keyId,
		orgName,
		areaId,
		industryId,
		sortNo,
		versionName,
		display,
		createTime)
		values
		(
		#{keyId},
		#{orgName},
		#{areaId},
		#{industryId},
		#{sortNo},
		#{versionName},
		#{display},
		sysDate)
	</insert>



	<!-- 修改机构信息 -->
	<update id="updateOrg">
		update SSD_EMS_HR_ORGLIST
		set orgName = #{orgName},areaId = #{areaId},industryId=#{industryId},sortNo = #{sortNo},versionName=#{versionName},display=#{display} 
	  	where keyId = #{keyId}
	</update>

 	<!-- 批量删除机构 -->
 	<delete id="deleteOrg">
 		DELETE FROM SSD_EMS_HR_ORGLIST where keyId in
			<foreach item="idItem" collection="orgidArr" open="(" separator="," close=")">
				#{idItem}
			</foreach>
 	</delete>


</mapper>